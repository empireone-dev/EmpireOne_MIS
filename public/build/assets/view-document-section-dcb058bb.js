import{a as w,r as d,j as a}from"./app-dbc57656.js";import"./summernote-editor2-d5577e42.js";import{h as D}from"./html2pdf-6731db19.js";import{B as I}from"./button-e865ad05.js";import{F as P}from"./FilePdfOutlined-967d64e1.js";import"./jd-blank-c9b38e3e.js";import"./UnorderedListOutlined-7f98f231.js";import"./presets-676bb1e6.js";import"./defineProperty-83f36300.js";import"./toPropertyKey-d8419463.js";import"./typeof-7fd5df1e.js";import"./AntdIcon-bcc0e9e6.js";import"./html2canvas.esm-4a769fde.js";import"./omit-644b1847.js";import"./genStyleUtils-caa979c9.js";import"./createSuper-c7e84a61.js";import"./Compact-b62cfa1f.js";import"./useSize-99942435.js";import"./index-f8b27f7a.js";import"./UnstableContext-61e5be0e.js";import"./regeneratorRuntime-92fa3873.js";import"./asyncToGenerator-8c72b493.js";function K(){var x,v;const{onboarding_ackdoc:g}=w(t=>t.onboarding_ackdocs),{onboarding_doc:r}=w(t=>t.onboarding_docs);d.useState({}),d.useState(!1);const[h,f]=d.useState(!1),[b,y]=d.useState(!1),i=d.useRef(null);console.log("onboarding_ackdoc:",g);const n=(g==null?void 0:g.length)>0?(x=g[0])==null?void 0:x.e_signature:null;console.log("eSignature:",n);const S=()=>{var e;let t=((e=r==null?void 0:r.data)==null?void 0:e.doc_content)??"";if(n&&n.signature){const s=`
                        <div style="display: inline-block; text-align: center; margin: 20px 0;">
                        <img 
                            src="${n.signature}" 
                            alt="Electronic Signature" 
                            style="max-width: 400px; max-height: 180px; background-color: white; display: block; margin: 0 auto; border: none; outline: none;"
                            loading="eager"
                        />
                        <div style="display: none; color: #6b7280; font-size: 14px;">
                            Signature image could not be loaded
                        </div>
                        <div style=" border-top: 1px solid #000; padding-top: 4px; text-transform: uppercase; letter-spacing: 1px;">
                            ${n.applicant?n.applicant.fname.toUpperCase():""} 
                            ${n.applicant?n.applicant.lname.toUpperCase():""}
                        </div>
                    </div>
            `;t+=s}return t},j=async t=>{try{const e=new Image;return e.crossOrigin="anonymous",new Promise(s=>{e.onload=()=>{try{const o=document.createElement("canvas"),u=o.getContext("2d");o.width=e.naturalWidth||e.width,o.height=e.naturalHeight||e.height,u.drawImage(e,0,0);const p=o.toDataURL("image/png");s(p)}catch(o){console.error("Canvas conversion error:",o),s(t)}},e.onerror=()=>{console.error("Image loading error for:",t),s(t)},e.src=t})}catch(e){return console.error("Error in convertImageToBase64:",e),t}},H=async()=>{var t;if(i.current){f(!0),y(!0);try{const e=i.current,s=`${(((t=r==null?void 0:r.data)==null?void 0:t.doc_name)??"Document").replace(/[^a-z0-9]/gi,"_").toLowerCase()}.pdf`,o={height:e.style.height,maxHeight:e.style.maxHeight,overflow:e.style.overflow};e.style.height="auto",e.style.maxHeight="none",e.style.overflow="visible";const u=e.querySelectorAll('img[alt="Electronic Signature"]');for(const l of u)try{const m=l.src;console.log("Converting signature image:",m);const c=await j(m);l.src=c,console.log("Signature converted successfully")}catch(m){console.error("Failed to convert signature:",m)}await new Promise(l=>setTimeout(l,1e3));const p={margin:[10,10,10,10],filename:s,image:{type:"jpeg",quality:1},html2canvas:{scale:2,useCORS:!0,allowTaint:!0,logging:!0,scrollX:0,scrollY:0,windowWidth:e.scrollWidth,windowHeight:e.scrollHeight,onclone:l=>{l.querySelectorAll('img[alt="Electronic Signature"]').forEach(c=>{c.style.display="block",c.style.visibility="visible",c.style.opacity="1",console.log("Cloned image src:",c.src.substring(0,50)+"...")})}},jsPDF:{unit:"mm",format:"a4",orientation:"portrait"},pagebreak:{mode:["avoid-all","css","legacy"],before:".page-break",avoid:["img","tr","td"]}};await D().set(p).from(e).save(),e.style.height=o.height,e.style.maxHeight=o.maxHeight,e.style.overflow=o.overflow}catch(e){console.error("Error generating PDF:",e),i.current&&(i.current.style.height="auto",i.current.style.maxHeight="none",i.current.style.overflow="visible")}finally{f(!1),y(!1)}}};return a.jsxs("div",{children:[a.jsx("div",{className:"mb-6 flex justify-end items-center",children:a.jsx(I,{type:"primary",icon:a.jsx(P,{}),onClick:H,loading:h,size:"large",className:"bg-red-600 hover:bg-red-700 border-red-600 hover:border-red-700",children:h?"Generating PDF...":"Download PDF"})}),a.jsxs("div",{ref:i,className:"bg-white p-8 shadow-sm border rounded-lg",style:{width:"100%",maxWidth:"none",minHeight:"auto",height:"auto"},children:[!b&&a.jsx("div",{className:"text-center mb-6",children:a.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:((v=r==null?void 0:r.data)==null?void 0:v.doc_name)??"No Document Title"})}),a.jsx("div",{className:"document-content",dangerouslySetInnerHTML:{__html:S()},style:{fontFamily:"Arial, sans-serif",lineHeight:"1.6",color:"#333",fontSize:"14px",width:"100%",wordWrap:"break-word",overflow:"visible",display:"block"}})]})]})}export{K as default};

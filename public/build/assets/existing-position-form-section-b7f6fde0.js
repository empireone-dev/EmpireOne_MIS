import{r as d,j as e,b as M,s as q,A as _}from"./store-9c50da1b.js";import{u}from"./app-87bf2fbc.js";import{c as A}from"./erf-record-thunk-4fbf4ad3.js";import{h as g}from"./moment-a9aaa855.js";import{B as m}from"./button-c8dca544.js";import{m as x}from"./index-a617c81a.js";import{A as R}from"./ArrowLeftOutlined-1453618a.js";import"./erf-record-service-b3950ea2.js";import"./erf-record-slice-c796a5be.js";import"./warning-8a11f3af.js";import"./defineProperty-83f36300.js";import"./toPropertyKey-d8419463.js";import"./typeof-7fd5df1e.js";import"./omit-644b1847.js";import"./genStyleUtils-00917081.js";import"./createSuper-f29e89b0.js";import"./Compact-79398905.js";import"./useSize-0508f9de.js";import"./index-48194c30.js";import"./shadow-371a5539.js";import"./UnstableContext-831bce8a.js";import"./AntdIcon-936c2873.js";import"./regeneratorRuntime-92fa3873.js";import"./asyncToGenerator-8c72b493.js";import"./CheckCircleFilled-0bc9ae28.js";import"./CloseCircleFilled-8016b598.js";import"./InfoCircleFilled-754e7ccb.js";import"./KeyCode-548a7212.js";import"./pickAttrs-120b0d1f.js";import"./useZIndex-485d43a8.js";import"./CloseOutlined-4e952bfd.js";function pe(){const{job_positions:f}=u(t=>t.job_positions),{erfCount:j}=u(t=>t.departments),{user:l}=u(t=>t.app),{accounts:v}=u(t=>t.accounts),[N,p]=d.useState(!1),[s,r]=d.useState({department:"",account:"",budgetCost:"",jobTitle:"",jobType:"",personnel:"",dateNeed:"",positionStatus:"",sourcingMethod:"",justification:"",site:(l==null?void 0:l.site)||"",user_id:(l==null?void 0:l.id)||""}),[y,w]=d.useState(0),[O,T]=d.useState(""),[i,a]=d.useState({});d.useEffect(()=>{(async()=>{try{const o=await M.get("/api/applications/today");w(o.data.count)}catch(o){console.error("Error fetching application count:",o)}})()},[]),d.useEffect(()=>{r(t=>({...t,ref_id:S()}))},[j]),d.useEffect(()=>{l!=null&&l.id&&r(t=>({...t,user_id:l.id,site:l.site||""}))},[l]);const S=()=>{const o=g(new Date).format("MMDDYYYY"),c=(y+j).toString().padStart(2,"0");return`${o}${c}`},C=t=>{const o=t.target.value,c=f.find(n=>n.jPosition===o);i.jobTitle&&a(n=>({...n,jobTitle:""})),r(c?n=>{var b;return{...n,department:c.outsourcing_erf.department,budgetCost:c.salary,jobTitle:o,account:((b=c.outsourcing_erf)==null?void 0:b.account)||n.account}}:n=>({...n,department:"",budgetCost:"",jobTitle:o,account:n.account})),T(o)},P=t=>{const o=t.target.value;console.log("Account changed to:",o),i.account&&a(c=>({...c,account:""})),r(c=>{const n={...c,account:o};return console.log("Updated form state:",n),n})},h=()=>{window.history.back()},E=async()=>{a({}),console.log("Form state before submission:",s),console.log("User object:",l);const t={};if(s.account||(t.account="Please select an account before submitting."),s.jobTitle||(t.jobTitle="Please select a job title before submitting."),s.jobType||(t.jobType="Please select a job type before submitting."),s.personnel||(t.personnel="Please enter the number of required personnel."),s.dateNeed||(t.dateNeed="Please select a target onboarding date."),s.positionStatus||(t.positionStatus="Please select a position status."),s.department||(t.department="Department is required. Please select a job title first."),s.sourcingMethod||(t.sourcingMethod="Please select a sourcing method."),(!s.justification||s.justification.trim()==="")&&(t.justification="Please provide a reason or justification for the request."),Object.keys(t).length>0){a(t);const o=Object.values(t)[0];x.error(o);return}p(!0);try{const o={submitted:g().format("YYYY-MM-DD"),user_id:(l==null?void 0:l.id)||s.user_id,site:(l==null?void 0:l.site)||s.site,ref_id:s.ref_id,department:s.department,account:s.account,budgetCost:s.budgetCost,jobTitle:s.jobTitle,jobType:s.jobType,personnel:s.personnel,dateNeed:s.dateNeed,positionStatus:s.positionStatus,sourcingMethod:s.sourcingMethod,justification:s.justification};console.log("Final data being sent to thunk:",o),await q.dispatch(A(o)),x.success("Successfully Added!"),setTimeout(()=>{p(!1),_.visit("/employee/erf_record")},2e3)}catch(o){console.error("Error submitting ERF:",o),x.error("Error submitting form. Please try again."),p(!1)}};return e.jsxs("div",{children:[e.jsx("div",{className:"mb-4",children:e.jsx(m,{onClick:h,icon:e.jsx(R,{}),className:"mb-4 flex items-center gap-2 bg-gray-100  hover:bg-gray-200",children:"Back"})}),e.jsxs("form",{children:[e.jsx("h1",{className:"text-xl font-semibold mb-3 text-gray-900 mt-6 text-center",children:"EMPLOYEE REQUISITION FORM"}),e.jsx("h1",{className:"text-lg",children:e.jsx("b",{children:"Instructions/Hiring Information"})}),e.jsxs("p",{children:["  Use this form to initiate the recruitment process for all new and existing staff. Please complete all applicable sections of this form."," ",e.jsx("b",{children:"NO OFFERS should be made, either verbally or in written form, before all approvals on the form are completed"}),"."]}),e.jsx("input",{onChange:t=>r({...s,site:t.target.value}),value:(s==null?void 0:s.site)??"",type:"hidden"}),e.jsxs("div",{className:"flex flex-1 w-full gap-4 mb-4 mt-4",children:[e.jsxs("div",{className:"w-full flex flex-col",children:[e.jsx("label",{children:e.jsx("b",{children:"Reference No."})}),e.jsx("input",{type:"text",value:s.ref_id||"",className:"border p-2 rounded w-full",readOnly:!0})]}),e.jsxs("div",{className:"w-full flex flex-col",children:[e.jsx("label",{children:e.jsx("b",{children:"Job Title"})}),e.jsxs("select",{className:`border p-2 rounded w-full ${i.jobTitle?"border-red-500":""}`,onChange:C,value:s.jobTitle,required:!0,children:[e.jsx("option",{value:"",children:"Select a job title"}),f.filter(t=>t.status==="Approved").map((t,o)=>e.jsx("option",{value:t.jPosition,children:t.jPosition},o))]}),i.jobTitle&&e.jsx("span",{className:"text-red-500 text-sm mt-1",children:i.jobTitle})]})]}),e.jsxs("div",{className:"flex flex-1 w-full gap-4 mb-4",children:[e.jsxs("div",{className:"w-full flex flex-col",children:[e.jsx("label",{children:e.jsx("b",{children:"Job Type"})}),e.jsxs("select",{onChange:t=>{r({...s,jobType:t.target.value}),i.jobType&&a(o=>({...o,jobType:""}))},className:`border p-2 rounded w-full ${i.jobType?"border-red-500":""}`,value:s.jobType,required:!0,children:[e.jsx("option",{value:"",children:"Select a job type"}),e.jsx("option",{value:"Full Time",children:"Full Time"}),e.jsx("option",{value:"Part Time",children:"Part Time"}),e.jsx("option",{value:"Contractual",children:"Contractual"}),e.jsx("option",{value:"Project-based",children:"Project-based"}),e.jsx("option",{value:"Temporary",children:"Temporary"})]}),i.jobType&&e.jsx("span",{className:"text-red-500 text-sm mt-1",children:i.jobType})]}),e.jsxs("div",{className:"w-full flex flex-col",children:[e.jsx("label",{children:e.jsx("b",{children:"No. of Required Personnel"})}),e.jsx("input",{type:"number",className:`border p-2 rounded w-full ${i.personnel?"border-red-500":""}`,onChange:t=>{r({...s,personnel:t.target.value}),i.personnel&&a(o=>({...o,personnel:""}))},value:s.personnel,required:!0}),i.personnel&&e.jsx("span",{className:"text-red-500 text-sm mt-1",children:i.personnel})]}),e.jsxs("div",{className:"w-full flex flex-col",children:[e.jsx("label",{children:e.jsx("b",{children:"Target Onboarding Date"})}),e.jsx("input",{type:"date",className:`border p-2 rounded w-full ${i.dateNeed?"border-red-500":""}`,onChange:t=>{r({...s,dateNeed:t.target.value}),i.dateNeed&&a(o=>({...o,dateNeed:""}))},value:s.dateNeed,required:!0}),i.dateNeed&&e.jsx("span",{className:"text-red-500 text-sm mt-1",children:i.dateNeed})]})]}),e.jsxs("div",{className:"flex flex-1 w-full gap-4 mb-4",children:[e.jsxs("div",{className:"w-full flex flex-col",children:[e.jsx("label",{children:e.jsx("b",{children:"Position Status"})}),e.jsxs("select",{onChange:t=>{r({...s,positionStatus:t.target.value}),i.positionStatus&&a(o=>({...o,positionStatus:""}))},className:`border p-2 rounded w-full ${i.positionStatus?"border-red-500":""}`,value:s.positionStatus,required:!0,children:[e.jsx("option",{value:"",children:"Select a position status"}),e.jsx("option",{children:"Replacement (due to resignation/termination/personnel movement)"}),e.jsx("option",{children:"Additional manpower"}),e.jsx("option",{children:"New Role"}),e.jsx("option",{children:"Internal Job Posting"})]}),i.positionStatus&&e.jsx("span",{className:"text-red-500 text-sm mt-1",children:i.positionStatus})]}),e.jsxs("div",{className:"w-full flex flex-col",children:[e.jsx("label",{children:e.jsx("b",{children:"Department"})}),e.jsx("input",{type:"text",value:s.department,className:"border p-2 rounded w-full",readOnly:!0})]}),e.jsxs("div",{className:"w-full flex flex-col",children:[e.jsx("label",{children:e.jsx("b",{children:"Account"})}),e.jsxs("select",{onChange:P,value:s.account||"",className:`border p-2 rounded w-full ${i.account?"border-red-500":""}`,name:"account",id:"account",required:!0,children:[e.jsx("option",{value:"",children:"Select an account"}),v.map((t,o)=>e.jsx("option",{value:t.acc,children:t.acc},o))]}),i.account&&e.jsx("span",{className:"text-red-500 text-sm mt-1",children:i.account})]}),e.jsxs("div",{className:"w-full flex flex-col",children:[e.jsx("label",{children:e.jsx("b",{children:"Sourcing Method"})}),e.jsxs("select",{onChange:t=>{r({...s,sourcingMethod:t.target.value}),i.sourcingMethod&&a(o=>({...o,sourcingMethod:""}))},className:`border p-2 rounded w-full ${i.sourcingMethod?"border-red-500":""}`,value:s.sourcingMethod,required:!0,children:[e.jsx("option",{value:"",children:"Select a sourcing method"}),e.jsx("option",{children:"Internal Candidates"}),e.jsx("option",{children:"External Candidates"}),e.jsx("option",{children:"Both"})]}),i.sourcingMethod&&e.jsx("span",{className:"text-red-500 text-sm mt-1",children:i.sourcingMethod})]})]}),e.jsxs("div",{className:"w-full flex flex-col mb-4",children:[e.jsx("label",{children:e.jsx("b",{children:"Reason or Justification of the Request"})}),e.jsx("textarea",{className:`border h-40 p-2 rounded w-full ${i.justification?"border-red-500":""}`,onChange:t=>{r({...s,justification:t.target.value}),i.justification&&a(o=>({...o,justification:""}))},value:s.justification,required:!0}),i.justification&&e.jsx("span",{className:"text-red-500 text-sm mt-1",children:i.justification})]}),e.jsxs("div",{className:"flex flex-1 w-full gap-4 mb-4",children:[e.jsxs("div",{className:"w-full flex flex-col",children:[e.jsx("label",{children:e.jsx("b",{children:"Manager Submitting Request"})}),e.jsx("input",{type:"text",value:`${(l==null?void 0:l.employee_fname)||""} ${(l==null?void 0:l.employee_lname)||""}`,className:"border p-2 rounded w-full",readOnly:!0})]}),e.jsxs("div",{className:"w-full flex flex-col",children:[e.jsx("label",{children:e.jsx("b",{children:"Budget/Cost per head:"})}),e.jsx("input",{type:"text",value:s.budgetCost,className:"border p-2 rounded w-full",onChange:t=>r({...s,budgetCost:t.target.value})})]})]}),e.jsxs("div",{className:"flex flex-1 gap-2 justify-end items-center",children:[e.jsx(m,{className:"rounded-md hover:bg-blue-100 w-32 h-10 mt-2",type:"button",onClick:h,children:"Back"}),e.jsx(m,{className:"bg-blue-600 rounded-md hover:bg-blue-700 text-white w-32 h-10 mt-2",type:"primary",onClick:E,loading:N,children:"Submit"})]})]})]})}export{pe as default};

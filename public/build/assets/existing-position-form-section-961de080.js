import{r as d,j as e,b as E,s as M,A as $}from"./store-9c50da1b.js";import{u}from"./app-cb169070.js";import{c as A}from"./erf-record-thunk-4fbf4ad3.js";import{h as g}from"./moment-a9aaa855.js";import{B as p}from"./button-81da3f66.js";import{m as x}from"./index-312d5210.js";import{A as R}from"./ArrowLeftOutlined-1453618a.js";import"./erf-record-service-b3950ea2.js";import"./erf-record-slice-c796a5be.js";import"./warning-8a11f3af.js";import"./defineProperty-83f36300.js";import"./toPropertyKey-d8419463.js";import"./typeof-7fd5df1e.js";import"./omit-644b1847.js";import"./genStyleUtils-bfbcc1a4.js";import"./createSuper-f29e89b0.js";import"./Compact-10a14527.js";import"./useSize-ae44f5e8.js";import"./index-7dfac90c.js";import"./shadow-371a5539.js";import"./UnstableContext-6656223a.js";import"./AntdIcon-936c2873.js";import"./regeneratorRuntime-92fa3873.js";import"./asyncToGenerator-8c72b493.js";import"./CheckCircleFilled-0bc9ae28.js";import"./CloseCircleFilled-8016b598.js";import"./InfoCircleFilled-754e7ccb.js";import"./KeyCode-3dcdafbc.js";import"./pickAttrs-120b0d1f.js";import"./useZIndex-ed5e7775.js";import"./CloseOutlined-4e952bfd.js";function pe(){const{job_positions:f}=u(t=>t.job_positions),{erfCount:j}=u(t=>t.departments),{user:i}=u(t=>t.app),{users:v}=u(t=>t.app),{accounts:N}=u(t=>t.accounts),[w,m]=d.useState(!1),[o,l]=d.useState({department:"",account:"",budgetCost:"",jobTitle:"",jobType:"",personnel:"",dateNeed:"",positionStatus:"",sourcingMethod:"",justification:"",reviewer:"",site:(i==null?void 0:i.site)||"",user_id:(i==null?void 0:i.id)||"",requestor_name:`${(i==null?void 0:i.employee_fname)||""} ${(i==null?void 0:i.employee_lname)||""}`}),[y,T]=d.useState(0),[O,C]=d.useState(""),[r,n]=d.useState({});d.useEffect(()=>{(async()=>{try{const s=await E.get("/api/applications/today");T(s.data.count)}catch(s){console.error("Error fetching application count:",s)}})()},[]),d.useEffect(()=>{l(t=>({...t,ref_id:S()}))},[j]),d.useEffect(()=>{i!=null&&i.id&&l(t=>({...t,user_id:i.id,site:i.site||"",requestor_name:`${i.employee_fname||""} ${i.employee_lname||""}`}))},[i]);const S=()=>{const s=g(new Date).format("MMDDYYYY"),c=(y+j).toString().padStart(2,"0");return`${s}${c}`},_=t=>{const s=t.target.value,c=f.find(a=>a.jPosition===s);r.jobTitle&&n(a=>({...a,jobTitle:""})),l(c?a=>{var b;return{...a,department:c.outsourcing_erf.department,budgetCost:c.salary,jobTitle:s,account:((b=c.outsourcing_erf)==null?void 0:b.account)||a.account}}:a=>({...a,department:"",budgetCost:"",jobTitle:s,account:a.account})),C(s)},P=t=>{const s=t.target.value;console.log("Account changed to:",s),r.account&&n(c=>({...c,account:""})),l(c=>{const a={...c,account:s};return console.log("Updated form state:",a),a})},h=()=>{window.history.back()},q=async()=>{n({}),console.log("Form state before submission:",o),console.log("User object:",i);const t={};if(o.account||(t.account="Please select an account before submitting."),o.jobTitle||(t.jobTitle="Please select a job title before submitting."),o.jobType||(t.jobType="Please select a job type before submitting."),o.personnel||(t.personnel="Please enter the number of required personnel."),o.dateNeed||(t.dateNeed="Please select a target onboarding date."),o.positionStatus||(t.positionStatus="Please select a position status."),o.department||(t.department="Department is required. Please select a job title first."),o.sourcingMethod||(t.sourcingMethod="Please select a sourcing method."),(!o.justification||o.justification.trim()==="")&&(t.justification="Please provide a reason or justification for the request."),(!o.reviewer||o.reviewer.trim()==="")&&(t.reviewer="Please select a reviewer."),Object.keys(t).length>0){n(t);const s=Object.values(t)[0];x.error(s);return}m(!0);try{const s={submitted:g().format("YYYY-MM-DD"),user_id:(i==null?void 0:i.id)||o.user_id,site:(i==null?void 0:i.site)||o.site,ref_id:o.ref_id,department:o.department,account:o.account,budgetCost:o.budgetCost,jobTitle:o.jobTitle,jobType:o.jobType,personnel:o.personnel,dateNeed:o.dateNeed,positionStatus:o.positionStatus,sourcingMethod:o.sourcingMethod,justification:o.justification,reviewer:o.reviewer,requestor_name:o.requestor_name};console.log("Final data being sent to thunk:",s),await M.dispatch(A(s)),x.success("Successfully Added!"),setTimeout(()=>{m(!1),$.visit("/employee/erf_record")},2e3)}catch(s){console.error("Error submitting ERF:",s),x.error("Error submitting form. Please try again."),m(!1)}};return e.jsxs("div",{children:[e.jsx("div",{className:"mb-4",children:e.jsx(p,{onClick:h,icon:e.jsx(R,{}),className:"mb-4 flex items-center gap-2 bg-gray-100  hover:bg-gray-200",children:"Back"})}),e.jsxs("form",{children:[e.jsx("h1",{className:"text-xl font-semibold mb-3 text-gray-900 mt-6 text-center",children:"EMPLOYEE REQUISITION FORM"}),e.jsx("h1",{className:"text-lg",children:e.jsx("b",{children:"Instructions/Hiring Information"})}),e.jsxs("p",{children:["  Use this form to initiate the recruitment process for all new and existing staff. Please complete all applicable sections of this form."," ",e.jsx("b",{children:"NO OFFERS should be made, either verbally or in written form, before all approvals on the form are completed"}),"."]}),e.jsx("input",{onChange:t=>l({...o,site:t.target.value}),value:(o==null?void 0:o.site)??"",type:"hidden"}),e.jsxs("div",{className:"flex flex-1 w-full gap-4 mb-4 mt-4",children:[e.jsxs("div",{className:"w-full flex flex-col",children:[e.jsx("label",{children:e.jsx("b",{children:"Reference No."})}),e.jsx("input",{type:"text",value:o.ref_id||"",className:"border p-2 rounded w-full",readOnly:!0})]}),e.jsxs("div",{className:"w-full flex flex-col",children:[e.jsx("label",{children:e.jsx("b",{children:"Job Title"})}),e.jsxs("select",{className:`border p-2 rounded w-full ${r.jobTitle?"border-red-500":""}`,onChange:_,value:o.jobTitle,required:!0,children:[e.jsx("option",{value:"",children:"Select a job title"}),f.filter(t=>t.status==="Approved").map((t,s)=>e.jsx("option",{value:t.jPosition,children:t.jPosition},s))]}),r.jobTitle&&e.jsx("span",{className:"text-red-500 text-sm mt-1",children:r.jobTitle})]})]}),e.jsxs("div",{className:"flex flex-1 w-full gap-4 mb-4",children:[e.jsxs("div",{className:"w-full flex flex-col",children:[e.jsx("label",{children:e.jsx("b",{children:"Job Type"})}),e.jsxs("select",{onChange:t=>{l({...o,jobType:t.target.value}),r.jobType&&n(s=>({...s,jobType:""}))},className:`border p-2 rounded w-full ${r.jobType?"border-red-500":""}`,value:o.jobType,required:!0,children:[e.jsx("option",{value:"",children:"Select a job type"}),e.jsx("option",{value:"Full Time",children:"Full Time"}),e.jsx("option",{value:"Part Time",children:"Part Time"}),e.jsx("option",{value:"Contractual",children:"Contractual"}),e.jsx("option",{value:"Project-based",children:"Project-based"}),e.jsx("option",{value:"Temporary",children:"Temporary"})]}),r.jobType&&e.jsx("span",{className:"text-red-500 text-sm mt-1",children:r.jobType})]}),e.jsxs("div",{className:"w-full flex flex-col",children:[e.jsx("label",{children:e.jsx("b",{children:"No. of Required Personnel"})}),e.jsx("input",{type:"number",className:`border p-2 rounded w-full ${r.personnel?"border-red-500":""}`,onChange:t=>{l({...o,personnel:t.target.value}),r.personnel&&n(s=>({...s,personnel:""}))},value:o.personnel,required:!0}),r.personnel&&e.jsx("span",{className:"text-red-500 text-sm mt-1",children:r.personnel})]}),e.jsxs("div",{className:"w-full flex flex-col",children:[e.jsx("label",{children:e.jsx("b",{children:"Target Onboarding Date"})}),e.jsx("input",{type:"date",className:`border p-2 rounded w-full ${r.dateNeed?"border-red-500":""}`,onChange:t=>{l({...o,dateNeed:t.target.value}),r.dateNeed&&n(s=>({...s,dateNeed:""}))},value:o.dateNeed,required:!0}),r.dateNeed&&e.jsx("span",{className:"text-red-500 text-sm mt-1",children:r.dateNeed})]})]}),e.jsxs("div",{className:"flex flex-1 w-full gap-4 mb-4",children:[e.jsxs("div",{className:"w-full flex flex-col",children:[e.jsx("label",{children:e.jsx("b",{children:"Position Status"})}),e.jsxs("select",{onChange:t=>{l({...o,positionStatus:t.target.value}),r.positionStatus&&n(s=>({...s,positionStatus:""}))},className:`border p-2 rounded w-full ${r.positionStatus?"border-red-500":""}`,value:o.positionStatus,required:!0,children:[e.jsx("option",{value:"",children:"Select a position status"}),e.jsx("option",{children:"Replacement (due to resignation/termination/personnel movement)"}),e.jsx("option",{children:"Additional manpower"}),e.jsx("option",{children:"New Role"}),e.jsx("option",{children:"Internal Job Posting"})]}),r.positionStatus&&e.jsx("span",{className:"text-red-500 text-sm mt-1",children:r.positionStatus})]}),e.jsxs("div",{className:"w-full flex flex-col",children:[e.jsx("label",{children:e.jsx("b",{children:"Department"})}),e.jsx("input",{type:"text",value:o.department,className:"border p-2 rounded w-full",readOnly:!0})]}),e.jsxs("div",{className:"w-full flex flex-col",children:[e.jsx("label",{children:e.jsx("b",{children:"Account"})}),e.jsxs("select",{onChange:P,value:o.account||"",className:`border p-2 rounded w-full ${r.account?"border-red-500":""}`,name:"account",id:"account",required:!0,children:[e.jsx("option",{value:"",children:"Select an account"}),[...N].sort((t,s)=>t.acc.localeCompare(s.acc)).map((t,s)=>e.jsx("option",{value:t.acc,children:t.acc},s))]}),r.account&&e.jsx("span",{className:"text-red-500 text-sm mt-1",children:r.account})]}),e.jsxs("div",{className:"w-full flex flex-col",children:[e.jsx("label",{children:e.jsx("b",{children:"Sourcing Method"})}),e.jsxs("select",{onChange:t=>{l({...o,sourcingMethod:t.target.value}),r.sourcingMethod&&n(s=>({...s,sourcingMethod:""}))},className:`border p-2 rounded w-full ${r.sourcingMethod?"border-red-500":""}`,value:o.sourcingMethod,required:!0,children:[e.jsx("option",{value:"",children:"Select a sourcing method"}),e.jsx("option",{children:"Internal Candidates"}),e.jsx("option",{children:"External Candidates"}),e.jsx("option",{children:"Both"})]}),r.sourcingMethod&&e.jsx("span",{className:"text-red-500 text-sm mt-1",children:r.sourcingMethod})]})]}),e.jsxs("div",{className:"w-full flex flex-col mb-4",children:[e.jsx("label",{children:e.jsx("b",{children:"Reason or Justification of the Request"})}),e.jsx("textarea",{className:`border h-40 p-2 rounded w-full ${r.justification?"border-red-500":""}`,onChange:t=>{l({...o,justification:t.target.value}),r.justification&&n(s=>({...s,justification:""}))},value:o.justification,required:!0}),r.justification&&e.jsx("span",{className:"text-red-500 text-sm mt-1",children:r.justification})]}),e.jsxs("div",{className:"flex flex-1 w-full gap-4 mb-4",children:[e.jsxs("div",{className:"w-full flex flex-col",children:[e.jsx("label",{children:e.jsx("b",{children:"Manager Submitting Request"})}),e.jsx("input",{type:"text",value:`${(i==null?void 0:i.employee_fname)||""} ${(i==null?void 0:i.employee_lname)||""}`,className:"border p-2 rounded w-full",readOnly:!0})]}),e.jsxs("div",{className:"w-full flex flex-col",children:[e.jsx("label",{children:e.jsx("b",{children:"Budget/Cost per head:"})}),e.jsx("input",{type:"text",value:o.budgetCost,className:"border p-2 rounded w-full",onChange:t=>l({...o,budgetCost:t.target.value})})]})]}),e.jsxs("div",{className:"w-full flex flex-col mb-4",children:[e.jsx("label",{children:e.jsx("b",{children:"Reviewer"})}),e.jsxs("select",{onChange:t=>{l({...o,reviewer:t.target.value}),r.reviewer&&n(s=>({...s,reviewer:""}))},value:o.reviewer||"",className:`border p-2 rounded w-full ${r.reviewer?"border-red-500":""}`,name:"reviewer",id:"reviewer",required:!0,children:[e.jsx("option",{value:"",disabled:!0,children:"Select a reviewer"}),v.filter(t=>t.id=="717"||t.id=="892").sort((t,s)=>t.employee_fname.localeCompare(s.employee_fname)).map((t,s)=>e.jsxs("option",{value:t.id,children:[t.employee_fname," ",t.employee_lname]},s))]}),r.reviewer&&e.jsx("span",{className:"text-red-500 text-sm mt-1",children:r.reviewer})]}),e.jsxs("div",{className:"flex flex-1 gap-2 justify-end items-center",children:[e.jsx(p,{className:"rounded-md hover:bg-blue-100 w-32 h-10 mt-2",type:"button",onClick:h,children:"Back"}),e.jsx(p,{className:"bg-blue-600 rounded-md hover:bg-blue-700 text-white w-32 h-10 mt-2",type:"primary",onClick:q,loading:w,children:"Submit"})]})]})]})}export{pe as default};

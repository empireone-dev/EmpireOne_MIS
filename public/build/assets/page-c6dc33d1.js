import{r as n,j as e,b as f}from"./store-9c50da1b.js";import{h as H}from"./moment-a9aaa855.js";import{S as N}from"./index-5dd256ce.js";import{A as I}from"./index-fcbb01ae.js";import{B as l}from"./button-81da3f66.js";import{R as V,C as S}from"./row-788ff89b.js";import{C as j}from"./index-96f6c453.js";import{B as Y}from"./index-b3eef7bb.js";import{D as i}from"./index-223d256f.js";import{D as q}from"./index-53bbb260.js";import{M as O}from"./index-4a19de55.js";import{T as U}from"./index-7b81519f.js";import{I as z}from"./index-737d2520.js";import{m as d}from"./index-312d5210.js";import{F as _}from"./FileTextOutlined-ab54bf29.js";import{U as G}from"./UserOutlined-1a65c324.js";import"./warning-8a11f3af.js";import"./defineProperty-83f36300.js";import"./toPropertyKey-d8419463.js";import"./typeof-7fd5df1e.js";import"./genStyleUtils-bfbcc1a4.js";import"./createSuper-f29e89b0.js";import"./Compact-10a14527.js";import"./useSize-ae44f5e8.js";import"./index-7dfac90c.js";import"./shadow-371a5539.js";import"./app-cb169070.js";import"./CheckCircleFilled-0bc9ae28.js";import"./AntdIcon-936c2873.js";import"./CloseCircleFilled-8016b598.js";import"./CloseOutlined-4e952bfd.js";import"./InfoCircleFilled-754e7ccb.js";import"./pickAttrs-120b0d1f.js";import"./omit-644b1847.js";import"./UnstableContext-6656223a.js";import"./regeneratorRuntime-92fa3873.js";import"./asyncToGenerator-8c72b493.js";import"./index-004422fa.js";import"./responsiveObserver-5bd3aac8.js";import"./Skeleton-d7a4eeac.js";import"./index-52d66546.js";import"./index-72bce993.js";import"./useId-e8f98549.js";import"./index-d4714c9c.js";import"./KeyCode-3dcdafbc.js";import"./PlusOutlined-4a5ed35b.js";import"./Dropdown-8abacbee.js";import"./useVariants-c8100210.js";import"./ContextIsolator-0f7eaafc.js";import"./index-c0883c00.js";import"./useZIndex-ed5e7775.js";import"./useBreakpoint-484a0cfc.js";import"./useForceUpdate-1fd08af1.js";import"./index-9f870b55.js";import"./fade-14773dcd.js";import"./useClosable-8f79493c.js";import"./useLocale-53dc42ed.js";import"./PurePanel-c7470f54.js";import"./EditOutlined-44724981.js";import"./styleChecker-e74b8545.js";import"./CheckOutlined-f2177a54.js";import"./CopyOutlined-a7df096a.js";import"./Input-eca7473d.js";import"./EyeOutlined-8119b4ba.js";const{Title:K,Text:c}=U,{TextArea:Q}=z;function at(){const[t,u]=n.useState(null),[C,y]=n.useState(!0),[b,E]=n.useState(null),[h,p]=n.useState(!1),[T,x]=n.useState(!1),[m,g]=n.useState(""),a=window.location.pathname.split("/")[3],s=r=>r==null||r===""||r==="undefined"?"--":r,k=r=>r?H(r).format("MMMM DD, YYYY"):"--",A=r=>{switch(r==null?void 0:r.toLowerCase()){case"approved":return"success";case"approved by site head":return"processing";case"declined":return"error";case"pending":return"processing";default:return"default"}};n.useEffect(()=>{(async()=>{try{if(a){y(!0);const o=await f.get(`/api/outsourcing_erf_by_id/${a}`);u(o.data.data),console.log("ERF Data:",o.data.data)}else E("No reference ID provided")}catch(o){console.error("Error fetching ERF data:",o),E("Failed to fetch ERF details")}finally{y(!1)}})()},[a]);const B=()=>{window.history.back()},M=async()=>{try{p(!0),(await f.put(`/api/outsourcing_erf/${t.id}`,{id:t.id,status:"Approved by Site Head",ref_id:t.ref_id,budgetCost:t.budgetCost,jobTitle:t.jobTitle,site:t.site})).status===200&&(d.success("ERF has been approved by Site Head successfully"),u(o=>({...o,status:"Approved by Site Head"})))}catch(r){console.error("Error approving ERF:",r),d.error("Failed to approve ERF. Please try again.")}finally{p(!1)}},P=()=>{x(!0)},$=async()=>{var r,o,D,R,w,v;if(!m.trim()){d.error("Please provide a reason for declining the ERF");return}try{p(!0),(await f.put(`/api/outsourcing_erf/${t.id}`,{id:t.id,status:"Declined",reason:m,ref_id:t.ref_id,requestor_email:((D=(o=(r=t.user)==null?void 0:r.employee)==null?void 0:o.applicant)==null?void 0:D.email)||((w=(R=t.user)==null?void 0:R.employee)==null?void 0:w.eogs)||((v=t.user)==null?void 0:v.email)})).status===200&&(d.success("ERF has been declined successfully"),u(J=>({...J,status:"Declined",reason:m})),x(!1),g(""))}catch(F){console.error("Error declining ERF:",F),d.error("Failed to decline ERF. Please try again.")}finally{p(!1)}},L=()=>{x(!1),g("")};return C?e.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"400px"},children:e.jsx(N,{size:"large",tip:"Loading ERF details..."})}):b?e.jsx("div",{style:{padding:"20px"},children:e.jsx(I,{message:"Error",description:b,type:"error",showIcon:!0,action:e.jsx(l,{onClick:B,type:"primary",children:"Go Back"})})}):e.jsxs("div",{style:{padding:"24px",background:"#f5f5f5",minHeight:"100vh"},children:[e.jsxs("div",{style:{marginBottom:"24px"},children:[e.jsxs(K,{level:2,style:{margin:0},children:[e.jsx(_,{style:{marginRight:"8px"}}),"Employee Requisition Form Details"]}),e.jsxs(c,{type:"secondary",children:["Reference ID: ",s(t.ref_id)]})]}),e.jsxs(V,{gutter:[24,24],children:[e.jsxs(S,{xs:24,lg:16,children:[e.jsxs(j,{title:"ERF Information",style:{marginBottom:"24px"},extra:e.jsx(Y,{status:A(t.status),text:s(t.status)}),children:[e.jsxs(i,{bordered:!0,column:{xs:1,sm:2},children:[e.jsx(i.Item,{label:"Job Title",children:e.jsx("strong",{children:s(t.jobTitle)})}),e.jsx(i.Item,{label:"Job Type",children:s(t.jobType)}),e.jsx(i.Item,{label:"Department",children:s(t.department)}),e.jsx(i.Item,{label:"Account",children:s(t.account)}),e.jsx(i.Item,{label:"No. of Personnel",children:s(t.personnel)}),e.jsx(i.Item,{label:"Target Date",children:k(t.dateNeed)}),e.jsx(i.Item,{label:"Position Status",children:s(t.positionStatus)}),e.jsx(i.Item,{label:"Sourcing Method",children:s(t.sourcingMethod)}),e.jsx(i.Item,{label:"Budget/Cost per head",children:t.budgetCost?`â‚±${parseFloat(t.budgetCost).toLocaleString()}`:"--"}),e.jsx(i.Item,{label:"Site",children:s(t.site)})]}),e.jsx(q,{}),e.jsxs(i,{bordered:!0,column:1,children:[e.jsx(i.Item,{label:"Justification/Reason",children:e.jsx("div",{style:{whiteSpace:"pre-wrap"},children:s(t.justification)})}),t.reason&&e.jsx(i.Item,{label:"Decline Reason",children:e.jsx(c,{type:"danger",style:{whiteSpace:"pre-wrap"},children:s(t.reason)})})]})]}),t.status==="Pending"&&e.jsxs("div",{style:{marginTop:"16px"},children:[e.jsx(l,{type:"primary",style:{margin:"10px",width:"45%"},loading:h,onClick:M,children:"Approve"}),e.jsx(l,{type:"danger",style:{margin:"10px",width:"45%"},loading:h,onClick:P,children:"Decline"})]}),t.status!=="Pending"&&e.jsx("div",{style:{marginTop:"16px",textAlign:"center"},children:e.jsx(I,{message:`ERF has been ${t.status}`,type:t.status==="Approved"?"success":t.status==="Approved by Site Head"?"info":"error",showIcon:!0})})]}),e.jsxs(S,{xs:24,lg:8,children:[e.jsx(j,{title:e.jsxs("span",{children:[e.jsx(G,{style:{marginRight:"8px"}}),"Requestor Information"]}),style:{marginBottom:"24px"},children:e.jsxs(i,{column:1,children:[e.jsx(i.Item,{label:"Submitted By",children:s(t.submitted)}),t.user&&e.jsxs(e.Fragment,{children:[e.jsx(i.Item,{label:"Full Name",children:`${s(t.user.employee_fname)} ${s(t.user.employee_lname)}`}),e.jsx(i.Item,{label:"Department",children:s(t.user.department)}),e.jsx(i.Item,{label:"Position",children:s(t.user.position)}),e.jsx(i.Item,{label:"Site",children:s(t.user.site)})]})]})}),e.jsx(j,{title:e.jsxs("span",{children:[e.jsx(_,{style:{marginRight:"8px"}}),"Job Documents"]}),children:e.jsxs("div",{style:{textAlign:"center"},children:[t.ja&&e.jsx(l,{type:"primary",style:{margin:"8px",width:"100%"},onClick:()=>{window.open(`/admin/sourcing/job_title_section/job_analysis/${a}`,"_blank")},children:"View Job Analysis"}),t.jd&&e.jsx(l,{type:"primary",style:{margin:"8px",width:"100%"},onClick:()=>{window.open(`/admin/sourcing/job_title_section/job_description/${a}`,"_blank")},children:"View Job Description"}),!t.ja&&!t.jd&&e.jsx(c,{type:"secondary",children:"No job documents available"})]})})]})]}),e.jsxs(O,{title:"Decline ERF",open:T,onOk:$,onCancel:L,confirmLoading:h,okText:"Decline ERF",okType:"danger",children:[e.jsx("div",{style:{marginBottom:"16px"},children:e.jsxs(c,{strong:!0,children:['Are you sure you want to decline this ERF for "',t==null?void 0:t.jobTitle,'"?']})}),e.jsxs("div",{children:[e.jsx(c,{children:"Please provide a reason for declining:"}),e.jsx(Q,{rows:4,value:m,onChange:r=>g(r.target.value),placeholder:"Enter the reason for declining this ERF...",style:{marginTop:"8px"}})]})]})]})}export{at as default};

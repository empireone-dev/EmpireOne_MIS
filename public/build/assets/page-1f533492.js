import{r as n,j as e,b as f}from"./store-a55f681c.js";import{h as H}from"./moment-a9aaa855.js";import{S as N}from"./index-fc2b2ac7.js";import{A as I}from"./index-5904beb8.js";import{B as l}from"./button-f23c5a7b.js";import{R as V,C as S}from"./row-5ba2a9da.js";import{C as j}from"./index-d7fd2578.js";import{B as Y}from"./index-2aca6008.js";import{D as i}from"./index-5d516297.js";import{D as q}from"./index-f4110bb7.js";import{M as O}from"./index-39b97e3b.js";import{T as U}from"./index-fd04b183.js";import{I as z}from"./index-5d4d2f3a.js";import{m as d}from"./index-a9b9aab0.js";import{F as _}from"./FileTextOutlined-aa087039.js";import{U as G}from"./UserOutlined-22dd6aa9.js";import"./warning-53117f39.js";import"./defineProperty-83f36300.js";import"./toPropertyKey-d8419463.js";import"./typeof-7fd5df1e.js";import"./genStyleUtils-a7424da4.js";import"./createSuper-f29e89b0.js";import"./Compact-5e8d7c79.js";import"./useSize-aaf01847.js";import"./index-bcc69c18.js";import"./shadow-0179b362.js";import"./app-2b4e2525.js";import"./CheckCircleFilled-aa27478c.js";import"./AntdIcon-d7012edb.js";import"./CloseCircleFilled-c59cb59e.js";import"./CloseOutlined-adb2771a.js";import"./InfoCircleFilled-de35a45c.js";import"./pickAttrs-36913342.js";import"./omit-644b1847.js";import"./UnstableContext-6fcf76c5.js";import"./regeneratorRuntime-92fa3873.js";import"./asyncToGenerator-8c72b493.js";import"./index-349f8d3e.js";import"./responsiveObserver-dd35f1bc.js";import"./Skeleton-aa5eb76b.js";import"./index-60447dc8.js";import"./index-39534d23.js";import"./useId-ed43986a.js";import"./index-62928ae1.js";import"./KeyCode-99629795.js";import"./PlusOutlined-86f0d02c.js";import"./Dropdown-92e6b838.js";import"./useVariants-9bb9b3df.js";import"./ContextIsolator-04fb1ac5.js";import"./index-192bbe31.js";import"./useZIndex-fb3092c3.js";import"./useBreakpoint-5c91a51b.js";import"./useForceUpdate-71bd788c.js";import"./index-f7c74257.js";import"./fade-52843f21.js";import"./useClosable-68ab5813.js";import"./useLocale-5a99632b.js";import"./PurePanel-419731ae.js";import"./EditOutlined-9af2df08.js";import"./styleChecker-ff91b116.js";import"./CheckOutlined-91571c5b.js";import"./CopyOutlined-b672b236.js";import"./Input-c0d2b7b2.js";import"./EyeOutlined-fe58294a.js";const{Title:K,Text:c}=U,{TextArea:Q}=z;function at(){const[t,u]=n.useState(null),[C,y]=n.useState(!0),[b,E]=n.useState(null),[h,p]=n.useState(!1),[T,x]=n.useState(!1),[m,g]=n.useState(""),a=window.location.pathname.split("/")[3],s=r=>r==null||r===""||r==="undefined"?"--":r,k=r=>r?H(r).format("MMMM DD, YYYY"):"--",A=r=>{switch(r==null?void 0:r.toLowerCase()){case"approved":return"success";case"approved by site head":return"processing";case"declined":return"error";case"pending":return"processing";default:return"default"}};n.useEffect(()=>{(async()=>{try{if(a){y(!0);const o=await f.get(`/api/outsourcing_erf_by_id/${a}`);u(o.data.data),console.log("ERF Data:",o.data.data)}else E("No reference ID provided")}catch(o){console.error("Error fetching ERF data:",o),E("Failed to fetch ERF details")}finally{y(!1)}})()},[a]);const B=()=>{window.history.back()},M=async()=>{try{p(!0),(await f.put(`/api/outsourcing_erf/${t.id}`,{id:t.id,status:"Approved by Site Head",ref_id:t.ref_id,budgetCost:t.budgetCost,jobTitle:t.jobTitle,site:t.site})).status===200&&(d.success("ERF has been approved by Site Head successfully"),u(o=>({...o,status:"Approved by Site Head"})))}catch(r){console.error("Error approving ERF:",r),d.error("Failed to approve ERF. Please try again.")}finally{p(!1)}},P=()=>{x(!0)},$=async()=>{var r,o,D,R,w,v;if(!m.trim()){d.error("Please provide a reason for declining the ERF");return}try{p(!0),(await f.put(`/api/outsourcing_erf/${t.id}`,{id:t.id,status:"Declined",reason:m,ref_id:t.ref_id,requestor_email:((D=(o=(r=t.user)==null?void 0:r.employee)==null?void 0:o.applicant)==null?void 0:D.email)||((w=(R=t.user)==null?void 0:R.employee)==null?void 0:w.eogs)||((v=t.user)==null?void 0:v.email)})).status===200&&(d.success("ERF has been declined successfully"),u(J=>({...J,status:"Declined",reason:m})),x(!1),g(""))}catch(F){console.error("Error declining ERF:",F),d.error("Failed to decline ERF. Please try again.")}finally{p(!1)}},L=()=>{x(!1),g("")};return C?e.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"400px"},children:e.jsx(N,{size:"large",tip:"Loading ERF details..."})}):b?e.jsx("div",{style:{padding:"20px"},children:e.jsx(I,{message:"Error",description:b,type:"error",showIcon:!0,action:e.jsx(l,{onClick:B,type:"primary",children:"Go Back"})})}):e.jsxs("div",{style:{padding:"24px",background:"#f5f5f5",minHeight:"100vh"},children:[e.jsxs("div",{style:{marginBottom:"24px"},children:[e.jsxs(K,{level:2,style:{margin:0},children:[e.jsx(_,{style:{marginRight:"8px"}}),"Employee Requisition Form Details"]}),e.jsxs(c,{type:"secondary",children:["Reference ID: ",s(t.ref_id)]})]}),e.jsxs(V,{gutter:[24,24],children:[e.jsxs(S,{xs:24,lg:16,children:[e.jsxs(j,{title:"ERF Information",style:{marginBottom:"24px"},extra:e.jsx(Y,{status:A(t.status),text:s(t.status)}),children:[e.jsxs(i,{bordered:!0,column:{xs:1,sm:2},children:[e.jsx(i.Item,{label:"Job Title",children:e.jsx("strong",{children:s(t.jobTitle)})}),e.jsx(i.Item,{label:"Job Type",children:s(t.jobType)}),e.jsx(i.Item,{label:"Department",children:s(t.department)}),e.jsx(i.Item,{label:"Account",children:s(t.account)}),e.jsx(i.Item,{label:"No. of Personnel",children:s(t.personnel)}),e.jsx(i.Item,{label:"Target Date",children:k(t.dateNeed)}),e.jsx(i.Item,{label:"Position Status",children:s(t.positionStatus)}),e.jsx(i.Item,{label:"Sourcing Method",children:s(t.sourcingMethod)}),e.jsx(i.Item,{label:"Budget/Cost per head",children:t.budgetCost?`â‚±${parseFloat(t.budgetCost).toLocaleString()}`:"--"}),e.jsx(i.Item,{label:"Site",children:s(t.site)})]}),e.jsx(q,{}),e.jsxs(i,{bordered:!0,column:1,children:[e.jsx(i.Item,{label:"Justification/Reason",children:e.jsx("div",{style:{whiteSpace:"pre-wrap"},children:s(t.justification)})}),t.reason&&e.jsx(i.Item,{label:"Decline Reason",children:e.jsx(c,{type:"danger",style:{whiteSpace:"pre-wrap"},children:s(t.reason)})})]})]}),t.status==="Pending"&&e.jsxs("div",{style:{marginTop:"16px"},children:[e.jsx(l,{type:"primary",style:{margin:"10px",width:"45%"},loading:h,onClick:M,children:"Approve"}),e.jsx(l,{type:"danger",style:{margin:"10px",width:"45%"},loading:h,onClick:P,children:"Decline"})]}),t.status!=="Pending"&&e.jsx("div",{style:{marginTop:"16px",textAlign:"center"},children:e.jsx(I,{message:`ERF has been ${t.status}`,type:t.status==="Approved"?"success":t.status==="Approved by Site Head"?"info":"error",showIcon:!0})})]}),e.jsxs(S,{xs:24,lg:8,children:[e.jsx(j,{title:e.jsxs("span",{children:[e.jsx(G,{style:{marginRight:"8px"}}),"Requestor Information"]}),style:{marginBottom:"24px"},children:e.jsxs(i,{column:1,children:[e.jsx(i.Item,{label:"Submitted By",children:s(t.submitted)}),t.user&&e.jsxs(e.Fragment,{children:[e.jsx(i.Item,{label:"Full Name",children:`${s(t.user.employee_fname)} ${s(t.user.employee_lname)}`}),e.jsx(i.Item,{label:"Department",children:s(t.user.department)}),e.jsx(i.Item,{label:"Position",children:s(t.user.position)}),e.jsx(i.Item,{label:"Site",children:s(t.user.site)})]})]})}),e.jsx(j,{title:e.jsxs("span",{children:[e.jsx(_,{style:{marginRight:"8px"}}),"Job Documents"]}),children:e.jsxs("div",{style:{textAlign:"center"},children:[t.ja&&e.jsx(l,{type:"primary",style:{margin:"8px",width:"100%"},onClick:()=>{window.open(`/admin/sourcing/job_title_section/job_analysis/${a}`,"_blank")},children:"View Job Analysis"}),t.jd&&e.jsx(l,{type:"primary",style:{margin:"8px",width:"100%"},onClick:()=>{window.open(`/admin/sourcing/job_title_section/job_description/${a}`,"_blank")},children:"View Job Description"}),!t.ja&&!t.jd&&e.jsx(c,{type:"secondary",children:"No job documents available"})]})})]})]}),e.jsxs(O,{title:"Decline ERF",open:T,onOk:$,onCancel:L,confirmLoading:h,okText:"Decline ERF",okType:"danger",children:[e.jsx("div",{style:{marginBottom:"16px"},children:e.jsxs(c,{strong:!0,children:['Are you sure you want to decline this ERF for "',t==null?void 0:t.jobTitle,'"?']})}),e.jsxs("div",{children:[e.jsx(c,{children:"Please provide a reason for declining:"}),e.jsx(Q,{rows:4,value:m,onChange:r=>g(r.target.value),placeholder:"Enter the reason for declining this ERF...",style:{marginTop:"8px"}})]})]})]})}export{at as default};

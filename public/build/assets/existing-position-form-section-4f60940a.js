import{r as i,j as e,b as P,s as _,A as E}from"./store-9c50da1b.js";import{u as d}from"./app-95876617.js";import{c as A}from"./erf-record-thunk-d5748df2.js";import{h as b}from"./moment-a9aaa855.js";import{B as p}from"./button-9ea3955a.js";import{m as c}from"./index-b14c5216.js";import{A as M}from"./ArrowLeftOutlined-1453618a.js";import"./erf-record-service-b3950ea2.js";import"./warning-8a11f3af.js";import"./defineProperty-83f36300.js";import"./toPropertyKey-d8419463.js";import"./typeof-7fd5df1e.js";import"./omit-644b1847.js";import"./genStyleUtils-00917081.js";import"./createSuper-f29e89b0.js";import"./Compact-bc97c7c9.js";import"./useSize-0508f9de.js";import"./index-cae7d5bd.js";import"./shadow-371a5539.js";import"./UnstableContext-1babe129.js";import"./AntdIcon-936c2873.js";import"./regeneratorRuntime-92fa3873.js";import"./asyncToGenerator-8c72b493.js";import"./CheckCircleFilled-0bc9ae28.js";import"./CloseCircleFilled-8016b598.js";import"./InfoCircleFilled-754e7ccb.js";import"./KeyCode-548a7212.js";import"./pickAttrs-120b0d1f.js";import"./useZIndex-485d43a8.js";import"./CloseOutlined-4e952bfd.js";function ce(){const{job_positions:m}=d(t=>t.job_positions),{erfCount:x}=d(t=>t.departments),{user:s}=d(t=>t.app),{accounts:j}=d(t=>t.accounts),[g,u]=i.useState(!1),[o,n]=i.useState({department:"",account:"",budgetCost:"",jobTitle:"",jobType:"",personnel:"",dateNeed:"",positionStatus:"",sourcingMethod:"",justification:"",site:(s==null?void 0:s.site)||""}),[v,N]=i.useState(0),[R,y]=i.useState("");i.useEffect(()=>{(async()=>{try{const l=await P.get("/api/applications/today");N(l.data.count)}catch(l){console.error("Error fetching application count:",l)}})()},[]),i.useEffect(()=>{n(t=>({...t,ref_id:w()}))},[x]),i.useEffect(()=>{s!=null&&s.id&&n(t=>({...t,user_id:s.id,site:s.site||""}))},[s]);const w=()=>{const l=b(new Date).format("MMDDYYYY"),a=(v+x).toString().padStart(2,"0");return`${l}${a}`},C=t=>{const l=t.target.value,a=m.find(r=>r.jPosition===l);n(a?r=>{var h;return{...r,department:a.outsourcing_erf.department,budgetCost:a.salary,jobTitle:l,account:((h=a.outsourcing_erf)==null?void 0:h.account)||r.account}}:r=>({...r,department:"",budgetCost:"",jobTitle:l,account:r.account})),y(l)},T=t=>{const l=t.target.value;console.log("Account changed to:",l),n(a=>{const r={...a,account:l};return console.log("Updated form state:",r),r})},f=()=>{window.history.back()},S=async()=>{if(!o.account){c.error("Please select an account before submitting.");return}if(!o.jobTitle){c.error("Please select a job title before submitting.");return}if(!o.jobType){c.error("Please select a job type before submitting.");return}if(!o.personnel){c.error("Please enter the number of required personnel.");return}if(!o.dateNeed){c.error("Please select a target onboarding date.");return}u(!0),console.log("Form state before submission:",o),console.log("User object:",s);try{const t={submitted:b().format("YYYY-MM-DD"),user_id:(s==null?void 0:s.id)||o.user_id,site:(s==null?void 0:s.site)||o.site,ref_id:o.ref_id,department:o.department,account:o.account,budgetCost:o.budgetCost,jobTitle:o.jobTitle,jobType:o.jobType,personnel:o.personnel,dateNeed:o.dateNeed,positionStatus:o.positionStatus,sourcingMethod:o.sourcingMethod,justification:o.justification};console.log("Final data being sent to thunk:",t),await _.dispatch(A(t)),c.success("Successfully Added!"),setTimeout(()=>{u(!1),E.visit("/admin/sourcing/resource_requests/erf_record")},2e3)}catch(t){console.error("Error submitting ERF:",t),c.error("Error submitting form. Please try again."),u(!1)}};return e.jsxs("div",{children:[e.jsx("div",{className:"mb-4",children:e.jsx(p,{onClick:f,icon:e.jsx(M,{}),className:"mb-4 flex items-center gap-2 bg-gray-100 border-gray-300 hover:bg-gray-200",children:"Back"})}),e.jsxs("form",{children:[e.jsx("h1",{className:"text-xl font-semibold mb-3 text-gray-900 mt-6 text-center",children:"EMPLOYEE REQUISITION FORM"}),e.jsx("h1",{className:"text-lg",children:e.jsx("b",{children:"Instructions/Hiring Information"})}),e.jsxs("p",{children:["  Use this form to initiate the recruitment process for all new and existing staff. Please complete all applicable sections of this form."," ",e.jsx("b",{children:"NO OFFERS should be made, either verbally or in written form, before all approvals on the form are completed"}),"."]}),e.jsx("input",{onChange:t=>n({...o,site:t.target.value}),value:(o==null?void 0:o.site)??"",type:"hidden"}),e.jsxs("div",{className:"flex flex-1 w-full gap-4 mb-4 mt-4",children:[e.jsxs("div",{className:"w-full flex flex-col",children:[e.jsx("label",{children:e.jsx("b",{children:"Reference No."})}),e.jsx("input",{type:"text",value:o.ref_id||"",className:"border p-2 rounded w-full",readOnly:!0})]}),e.jsxs("div",{className:"w-full flex flex-col",children:[e.jsx("label",{children:e.jsx("b",{children:"Job Title"})}),e.jsxs("select",{className:"border p-2 rounded w-full",onChange:C,value:o.jobTitle,children:[e.jsx("option",{value:""}),m.filter(t=>t.status==="Approved").map((t,l)=>e.jsx("option",{value:t.jPosition,children:t.jPosition},l))]})]})]}),e.jsxs("div",{className:"flex flex-1 w-full gap-4 mb-4",children:[e.jsxs("div",{className:"w-full flex flex-col",children:[e.jsx("label",{children:e.jsx("b",{children:"Job Type"})}),e.jsxs("select",{onChange:t=>n({...o,jobType:t.target.value}),className:"border p-2 rounded w-full",value:o.jobType,children:[e.jsx("option",{value:""}),e.jsx("option",{value:"Full Time",children:"Full Time"}),e.jsx("option",{value:"Part Time",children:"Part Time"}),e.jsx("option",{value:"Contractual",children:"Contractual"}),e.jsx("option",{value:"Project-based",children:"Project-based"}),e.jsx("option",{value:"Temporary",children:"Temporary"})]})]}),e.jsxs("div",{className:"w-full flex flex-col",children:[e.jsx("label",{children:e.jsx("b",{children:"No. of Required Personnel"})}),e.jsx("input",{type:"number",className:"border p-2 rounded w-full",onChange:t=>n({...o,personnel:t.target.value})})]}),e.jsxs("div",{className:"w-full flex flex-col",children:[e.jsx("label",{children:e.jsx("b",{children:"Target Onboarding Date"})}),e.jsx("input",{type:"date",className:"border p-2 rounded w-full",onChange:t=>n({...o,dateNeed:t.target.value})})]})]}),e.jsxs("div",{className:"flex flex-1 w-full gap-4 mb-4",children:[e.jsxs("div",{className:"w-full flex flex-col",children:[e.jsx("label",{children:e.jsx("b",{children:"Position Status"})}),e.jsxs("select",{onChange:t=>n({...o,positionStatus:t.target.value}),className:"border p-2 rounded w-full",value:o.positionStatus,children:[e.jsx("option",{value:""}),e.jsx("option",{children:"Replacement (due to resignation/termination/personnel movement)"}),e.jsx("option",{children:"Additional manpower"}),e.jsx("option",{children:"New Role"})]})]}),e.jsxs("div",{className:"w-full flex flex-col",children:[e.jsx("label",{children:e.jsx("b",{children:"Department"})}),e.jsx("input",{type:"text",value:o.department,className:"border p-2 rounded w-full",readOnly:!0})]}),e.jsxs("div",{className:"w-full flex flex-col",children:[e.jsx("label",{children:e.jsx("b",{children:"Account"})}),e.jsxs("div",{className:"text-xs text-gray-500 mb-1",children:['Current account value: "',o.account||"none selected",'"']}),e.jsxs("select",{onChange:T,value:o.account||"",className:"border p-2 rounded w-full",name:"account",id:"account",children:[e.jsx("option",{value:"",children:"Select an account"}),j.map((t,l)=>e.jsx("option",{value:t.acc,children:t.acc},l))]})]}),e.jsxs("div",{className:"w-full flex flex-col",children:[e.jsx("label",{children:e.jsx("b",{children:"Sourcing Method"})}),e.jsxs("select",{onChange:t=>n({...o,sourcingMethod:t.target.value}),className:"border p-2 rounded w-full",value:o.sourcingMethod,children:[e.jsx("option",{value:""}),e.jsx("option",{children:"Internal Candidates"}),e.jsx("option",{children:"External Candidates"}),e.jsx("option",{children:"Both"})]})]})]}),e.jsxs("div",{className:"w-full flex flex-col mb-4",children:[e.jsx("label",{children:e.jsx("b",{children:"Reason or Justification of the Request"})}),e.jsx("textarea",{className:"border h-40 p-2 rounded w-full",onChange:t=>n({...o,justification:t.target.value})})]}),e.jsxs("div",{className:"flex flex-1 w-full gap-4 mb-4",children:[e.jsxs("div",{className:"w-full flex flex-col",children:[e.jsx("label",{children:e.jsx("b",{children:"Manager Submitting Request"})}),e.jsx("input",{type:"text",value:`${(s==null?void 0:s.employee_fname)||""} ${(s==null?void 0:s.employee_lname)||""}`,className:"border p-2 rounded w-full",readOnly:!0})]}),e.jsxs("div",{className:"w-full flex flex-col",children:[e.jsx("label",{children:e.jsx("b",{children:"Budget/Cost per head:"})}),e.jsx("input",{type:"text",value:o.budgetCost,className:"border p-2 rounded w-full",onChange:t=>n({...o,budgetCost:t.target.value})})]})]}),e.jsxs("div",{className:"flex flex-1 gap-2 justify-end items-center",children:[e.jsx(p,{className:"rounded-md hover:bg-blue-100 w-32 h-10 mt-2",type:"button",onClick:f,children:"Back"}),e.jsx(p,{className:"bg-blue-600 rounded-md hover:bg-blue-700 text-white w-32 h-10 mt-2",type:"primary",onClick:S,loading:g,children:"Submit"})]})]})]})}export{ce as default};
